<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>16.TencentOS_tiny_LoRaWAN_Getting_Started_Guide - TencentOS Tiny 用户文档中心</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "16.TencentOS_tiny_LoRaWAN_Getting_Started_Guide";
        var mkdocs_page_input_path = "16.TencentOS_tiny_LoRaWAN_Getting_Started_Guide.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> TencentOS Tiny 用户文档中心
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../01.Introduction/">01.Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../02.Help/">02.Help</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../03.Summary/">03.Summary</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../04.Development_Manual/">04.Development_Manual</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../05.SDK_Manual/">05.SDK_Manual</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../06.FAQ/">06.FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../07.Glossary/">07.Glossary</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../08.QCloud_IoTHub_Quick_Start/">08.QCloud_IoTHub_Quick_Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../09.Code_Directories/">09.Code_Directories</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../10.Porting_Manual_for_KEIL/">10.Porting_Manual_for_KEIL</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../11.Porting_Manual_for_IAR/">11.Porting_Manual_for_IAR</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../12.Porting_Manual_for_GCC/">12.Porting_Manual_for_GCC</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../13.Porting_Manual_for_MacOS_STM32CubeIDE/">13.Porting_Manual_for_MacOS_STM32CubeIDE</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../14.RISC-V_Eclipse_Environment_Quick_Start/">14.RISC-V_Eclipse_Environment_Quick_Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../15.TencentOS_tiny_EVB_MX_Plus_Quick_Start/">15.TencentOS_tiny_EVB_MX_Plus_Quick_Start</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">16.TencentOS_tiny_LoRaWAN_Getting_Started_Guide</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#1-st-p-nucleo-lrwan3">1. ST P-NUCLEO-LRWAN3套件简介</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#11">1.1 开发套件简介</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#12-lorawan">1.2 LoRaWAN节点硬件详解</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#121-nucleo-l073rz-cortex-m0">1.2.1  NUCLEO-L073RZ 基于CORTEX-M0+的评估板</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#122-lrwan_ns1">1.2.2 LRWAN_NS1 扩展板硬件</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-lorawan">2. LoRaWAN节点软件开发环境准备</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#21-mdk">2.1 MDK软件介绍</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#22-mdk">2.2 MDK安装</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#23-pack">2.3 Pack安装</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#24-st-link">2.4 ST-Link驱动安装</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#25-mdk">2.5 编程软件(MDK)配置</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#26">2.6 串口调试助手的安装与使用</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3-tencentos-tiny">3. TencentOS tiny 基础内核实验</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#31-tencentos-tiny-hello_world">3.1 打开 TencentOS tiny提供的 Hello_world 工程</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#32-helloworld">3.2 编译HelloWorld工程</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#33">3.3 下载运行</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#34">3.4 查看运行结果</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#4-tencentos-tiny-atlorawaniot-explorer">4. 使用TencentOS tiny AT框架驱动LoRaWAN节点对接腾讯云IoT Explorer</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#41-lora">4.1 控制台操作 LoRa 节点</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#_1">创建项目和产品</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_2">新建产品</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_3">创建数据模板</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#lorawan">配置 LoRaWAN 参数</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_4">设备数据解析</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_8">创建测试设备</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#42-lora">4.2 控制台操作 LoRa 网关</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#43-lora">4.3 LoRa网关实物操作</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#_9">硬件连接</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_10">串口准备</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_11">配置修改</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_12">运行</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#44-lora">4.4 LoRa 节点实物操作</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#_13">编译及下载</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_14">查看运行结果</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#45">4.5 查看设备状态</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#46">4.6 查看设备通信日志</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#47">4.7 在线调试</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../17.Mini_Program_Quick_Start/">17.Mini_Program_Quick_Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../18.TencentOS_tiny_EVB_LX_RISC-V_Quick_Start/">18.TencentOS_tiny_EVB_LX_RISC-V_Quick_Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../19.TencentOS_Tiny_Simulator_Use_MDK/">19.TencentOS_Tiny_Simulator_Use_MDK</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../20.In_Application_Programming_based_EVB_MX_Plus/">20.In_Application_Programming_based_EVB_MX_Plus</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../21.OTA_Quick_Start_based_EVB_MX_Plus/">21.OTA_Quick_Start_based_EVB_MX_Plus</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../22.ElfLoader_Quick_Start/">22.ElfLoader_Quick_Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../23.CMSIS_RTOS_API_Use_Guide/">23.CMSIS_RTOS_API_Use_Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../24.How_To_Use_Esp8266_Tencent_Firmware_Connect_Iot_Explorer/">24.How_To_Use_Esp8266_Tencent_Firmware_Connect_Iot_Explorer</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../25.How_To_Use_Esp8266_Tencent_Firmware_Connect_Iot_Hub/">25.How_To_Use_Esp8266_Tencent_Firmware_Connect_Iot_Hub</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../26.TencentOS_tiny_EVB_WL_Quick_Start/">26.TencentOS_tiny_EVB_WL_Quick_Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../27.AT_Firmware_and_SAL_Firmware_User_Guide/">27.AT_Firmware_and_SAL_Firmware_User_Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../28.BLE_Device_Quick_Start/">28.BLE_Device_Quick_Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../29.TencentOS_Tiny_EVB_G0_QuickStart/">29.TencentOS_Tiny_EVB_G0_QuickStart</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">TencentOS Tiny 用户文档中心</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>16.TencentOS_tiny_LoRaWAN_Getting_Started_Guide</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="tencentos-tiny-lorawan">基于 TencentOS tiny 的 LoRaWAN 开发入门指南</h1>
<h2 id="1-st-p-nucleo-lrwan3">1. ST P-NUCLEO-LRWAN3套件简介</h2>
<h3 id="11">1.1 开发套件简介</h3>
<p>P-NUCLEO-LRWAN3是完整的套件，包括网关和节点，可用于评估LoRaWAN网络。使用该套件，用户可以轻松设置LPWAN网络，帮助用户学习LoRaWAN技术，了解如何在自己的应用程序中使用LoRaWAN技术。</p>
<p>LoRa网关套件由ST Nucleo-F746ZG底板和瑞兴恒方基于SX1301的LRWAN_GS模块组成。</p>
<p>ST Nucleo LoRa节点套件由LRWAN_NS1扩展板和ST Nucleo-L073底板组成。其中 LRWAN_NS1扩展板集成瑞兴恒方的RHF0M003 LoRaWAN模组，并集成了温湿度传感器HTS221、气压传感器LPS22HB、3轴磁力传感器LIS3MDL、6轴姿态传感器LSM6DS3共4个I2C传感器件。</p>
<p>开发套件实物图如下：</p>
<p><img alt="" src="../image/LoRaWAN/p_nucleo_lrwan3_kit.png" /></p>
<h3 id="12-lorawan">1.2 LoRaWAN节点硬件详解</h3>
<h4 id="121-nucleo-l073rz-cortex-m0">1.2.1  NUCLEO-L073RZ 基于CORTEX-M0+的评估板</h4>
<p><img alt="" src="../image/LoRaWAN/nucleo_l073rz.png" /></p>
<p>NUCLEO-L073RZ基于NUCLEO 64公版PCB设计，可以方便的更换ST的其它64PIN MCU。主要特性包括：</p>
<ul>
<li>LQFP64 STM32-L073RZT6 MCU</li>
<li>20KB SRAM 192KB Flash 6KB data EEPROM</li>
<li>两种类型扩展接口：Arduino UNO扩展接口；STM32 MORPHO扩展接口</li>
<li>板载ST-LINK/V2-1调试/编程器</li>
<li>灵活的供电方式选择</li>
<li>板载3个LED灯，LD1、LD3指示工作状态，LD2为用户可编程LED灯</li>
<li>两个按钮，复位及用户可编程按钮</li>
<li>USB重枚举能力，支持VCP，MSD，DEBUG功能</li>
<li>大量IDE开发环境支持</li>
</ul>
<p>扩展接口如下图所示：</p>
<p><img alt="" src="../image/LoRaWAN/nucleo_l073rz_pin.png" /></p>
<h4 id="122-lrwan_ns1">1.2.2 LRWAN_NS1 扩展板硬件</h4>
<p>1）扩展板接口兼容Arduino UNO接口，原理图如下：</p>
<p><img alt="" src="../image/LoRaWAN/nucleo_extend_arduino.png" /></p>
<p>2） 扩展板上同一个I2C端口，挂载了4个I2C接口的传感器，分别是温湿度传感器HTS221、气压传感器LPS22HB、3轴磁力传感器LIS3MDL、6轴姿态传感器LSM6DS3，原理图如下：</p>
<p><img alt="" src="../image/LoRaWAN/nucleo_extend_hts221.png" /></p>
<p><img alt="" src="../image/LoRaWAN/nucleo_extend_lps22hb.png" /></p>
<p><img alt="" src="../image/LoRaWAN/nucleo_extend_lis3mdl.png" /></p>
<p><img alt="" src="../image/LoRaWAN/nucleo_extend_lsm6ds3.png" /></p>
<p>3）LoRaWAN通信模组电路原理图</p>
<p><img alt="" src="../image/LoRaWAN/nucleo_extend_lora_module.png" /></p>
<h2 id="2-lorawan">2. LoRaWAN节点软件开发环境准备</h2>
<h3 id="21-mdk">2.1 MDK软件介绍</h3>
<p>MDK 即RealView MDK 或MDK-ARM（Microcontroller Development kit），是 ARM 公司收购Keil公司以后，基于uVision界面推出的针对ARM7、ARM9、Cortex-M0、Cortex-M1、Cortex-M2、Cortex-M3、Cortex-R4等ARM处理器的嵌入式软件开发工具。MDK-ARM 集成了业内最领先的技术，包括 uVision4 集成开发环境与 RealView 编译器RVCT。支持 ARM7、ARM9 和最新的Cortex-M3/M1/M0 核处理器，自动配置启动代码，集成 Flash 烧写模块，强大的 Simulation 设备模拟，性能分析等功能，与 ARM 之前的工具包 ADS 等相比，RealView 编译器的最新版本可将性能改善超过 20%。</p>
<p>Keil公司开发的ARM开发工具MDK，是用来开发基于ARM核的系列微控制器的嵌入式应用程序。它适合不同层次的开发者使用，包括专业的应用程序开发工程师和嵌入式软件开发的入门者。MDK包含了工业标准的Keil C编译器、宏汇编器、调试器、实时内核等组件，支持所有基于ARM的设备，能帮助工程师按照计划完成项目。</p>
<h3 id="22-mdk">2.2 MDK安装</h3>
<p>点击下面的地址下载MDK软件，软件版本最好是5.24及以上：
https://www.keil.com/download/product/
教程以5.24版本为例，双击MDK524应用程序文件，点击next&gt;&gt;。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_setup.png" /></p>
<p>打上 I agree前面的勾勾，即是同意一些安装协议。点击next&gt;&gt;。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_agree.png" /></p>
<p>选择安装路径，可以默认也可以安装在我们自己建立的文件夹下。点击next&gt;&gt;。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_path.png" /></p>
<p>这里填写的是我们的一些信息，填写完整后，继续next&gt;&gt;。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_info.png" /></p>
<p>然后等待安装完成即可。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_ing.png" /></p>
<p>安装完成，点击Finish。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_finish.png" /></p>
<p>然后会跳出来这个界面，这个我们后面再讲，先点OK，把弹框都叉掉。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_window.png" /></p>
<p>激活MDK，导入License,激活MDK后便可使用了。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_license_manage.png" /></p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_license_fill.png" /></p>
<p>特别提示：一定要输入License激活MDK软件，请购买正版License。</p>
<h3 id="23-pack">2.3 Pack安装</h3>
<p>安装完MDK后，我们需要安装开发套件中单片机型号对应的Pack。
安装方式一：登录官网：http://www.keil.com/dd2/pack/ <br />
下载Keil.STM32L0xx_DFP.2.0.0.pack 后安装，如下图</p>
<p><img alt="" src="../image/LoRaWAN/development_env_pack_setup.png" /></p>
<p>安装方式二：MDK软件上在线安装
打开软件，在导航栏打开Pack安装界面，然后选择ok选项。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_pack_setup_in_mdk.png" /></p>
<p>进入在线安装界面，选着STM32L0XX Pack,点击Install进行安装。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_pack_install_in_mdk.png" /></p>
<p>至此，我们开发板的单片机程序开发环境已经搭建完毕，重启MDK软件就可以使用了。</p>
<h3 id="24-st-link">2.4 ST-Link驱动安装</h3>
<p>前面讲了开发板单片机程序的开发环境的搭建，但是为了将程序烧录到开发板中我们还需要使用仿真器。我们这套开发板选用ST公司的ST-Link V2仿真器进行开发板程序的烧写和仿真，下面介绍ST-Link驱动的安装及环境搭建。  </p>
<p>在ST官网下载ST-Link驱动，
https://www.st.com/content/st_com/zh/products/development-tools/software-development-tools/stm32-software-development-tools/stm32-utilities/stsw-link009.html</p>
<p>（驱动有2种： 32位电脑系统安装“dpinst_x86”、64位电脑系统安装“dpinst_amd64”）。 </p>
<p><img alt="" src="../image/LoRaWAN/development_env_stlink_driver_file.png" /></p>
<p>运行对应的驱动，安装ST-Link V2驱动程序。安装路径尽量保持默认路径。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_stlink_driver_install.png" /></p>
<p>安装完成后, 将ST-Link通过USB接口连入电脑。打开“设备管理器”。若看到如下图所示，表示驱动安装成功。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_stlink_driver_ok.png" /></p>
<p>这里提醒 2 点:
1，  各种 windows 版本设备名称和所在设备管理器栏目可能不一样，例如 WIN10 插上STLINK 后显示的是 STM32 STLINK。
2，  如果设备名称旁边显示的是黄色的叹号，请直接点击设备名称，然后在弹出的界面点击更新设备驱动
至此， ST-Link 驱动已经安装完成。接下来大家只需要在 MDK工程里面配置一下 ST-Link即可。</p>
<h3 id="25-mdk">2.5 编程软件(MDK)配置</h3>
<p>安装驱动成功后，打开MDK软件，配置程序烧写和仿真的环境。
点击进入工程配置界面按纽，进入工程配置界面。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_config_click.png" /></p>
<p>选择Debug选项，进入仿真器设置界面。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_config_debug.png" /></p>
<p>下拉仿真器选择列表，选着ST-Link Debugger并勾选右侧Use,点击Settings进入ST-Link V2仿真器配置界面。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_config_debugger.png" /></p>
<p>开发板设计的程序烧录方式为SW，此处Unit选择ST-Link/V2,且Port选择SW,并确认右侧框内是否检测出SW设备，点击&lt;确认&gt;保存配置。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_mdk_config_debugger_setting.png" /></p>
<h3 id="26">2.6 串口调试助手的安装与使用</h3>
<p>工具下载： http://www.daxia.com/download/sscom.rar</p>
<p>安装方法：串口调试助手sscom5.13.1是免安装的，解压出压缩包即可直接使用。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_sscom.png" /></p>
<p>根据PC和终端之间的连接，选择正确的串行端口。
打开电脑的设备管理器，在端口列表可以看到PC与开发板连接的端口号。</p>
<p><img alt="" src="../image/LoRaWAN/development_env_sscom_port.png" /></p>
<p>我这里显示的是COM6，所以要在sscom工具中选择COM6，开发板程序波特率设置为115200，所以我在sscom串口工具中选择115200波特率。</p>
<h2 id="3-tencentos-tiny">3. TencentOS tiny 基础内核实验</h2>
<h3 id="31-tencentos-tiny-hello_world">3.1 打开 TencentOS tiny提供的 Hello_world 工程</h3>
<p>TencentOS tiny官方开源仓下载源码，地址为：
https://github.com/Tencent/TencentOS-tiny</p>
<p>进入 &lt; TencentOS-tiny/board/NUCLEO_STM32L073RZ/KEIL/hello_world&gt; 目录，打开TencentOS_tiny.uvprojx工程：</p>
<p><img alt="" src="../image/LoRaWAN/hello_open.png" /></p>
<h3 id="32-helloworld">3.2 编译HelloWorld工程</h3>
<p>打开工程后，我们在左侧的工程文件导航页面展开examples目录，可以看到helloworld.c源码，这里创建了两个TencentOS tiny的任务，交替运行打印任务。开发者安装下图指示，点击编译按钮即可编译工程，如图：</p>
<p><img alt="" src="../image/LoRaWAN/hello_build.png" /></p>
<h3 id="33">3.3 下载运行</h3>
<p>首先需要配置下载环境</p>
<p><img alt="" src="../image/LoRaWAN/hello_download_click.png" /></p>
<p>按下图所示配置下载参数</p>
<p><img alt="" src="../image/LoRaWAN/hello_download_debug.png" /></p>
<p><img alt="" src="../image/LoRaWAN/hello_download_flash.png" /></p>
<p>编译完成后点击如图所示”LOAD”按钮下载程序即可。</p>
<p><img alt="" src="../image/LoRaWAN/hello_download_go.png" /></p>
<h3 id="34">3.4 查看运行结果</h3>
<p>连接好串口，在PC的串口助手中可以看到TencentOS tiny的两个任务交替运行，打印消息并完成任务计数，如下图所示：</p>
<p><img alt="" src="../image/LoRaWAN/hello_run.png" /></p>
<p>更多TencentOS tiny基础内核的使用，请参考内核开发指南文档：
TencentOS_tiny\doc\04.TencentOS_tiny_Development_Guide.md
TencentOS_tiny\doc\05.TencentOS_tiny_SDK_documentation.md</p>
<h2 id="4-tencentos-tiny-atlorawaniot-explorer">4. 使用TencentOS tiny AT框架驱动LoRaWAN节点对接腾讯云IoT Explorer</h2>
<p>本实验中假设一款 LoRa 温湿度传感器 接入到物联网开发平台，通过物联网开发平台可以远程查看传感器的温度、湿度，并可远程配置传感器的上报周期。本文档主要指导您如何在物联网开发平台控制台接入 LoRa 温湿度传感器。</p>
<h3 id="41-lora">4.1 控制台操作 LoRa 节点</h3>
<h4 id="_1">创建项目和产品</h4>
<ol>
<li>登录 <a href="https://console.cloud.tencent.com/iotexplorer">物联网开发平台控制台</a>，选择【新建项目】。</li>
<li>在新建项目页面，填写项目基本信息后，单击【保存】<ul>
<li>项目名称：输入“LoRa 温湿度传感器演示”或其他名称。</li>
<li>项目描述：按照实际需求填写项目描述。</li>
</ul>
</li>
<li>项目新建成功后，即可新建产品。</li>
</ol>
<h4 id="_2">新建产品</h4>
<ol>
<li>进入该项目的产品列表页面，单击【新建产品】。</li>
<li>在新建产品页面，填写产品基本信息。<ul>
<li>产品名称：输入“温湿度传感器”或其他产品名称。</li>
<li>产品类型：选择“温湿度传感器”。</li>
<li>认证方式：选择“密钥认证”。</li>
<li>通信方式：选择“LoRaWAN”。
<img alt="" src="../image/LoRaWAN/explorer_guide_1_1_product_creat_ths_new.png" /></li>
</ul>
</li>
<li>产品新建成功后，您可在产品列表页查看“LoRa 温湿度传感器”。</li>
</ol>
<h4 id="_3">创建数据模板</h4>
<p>单击产品名称，进入产品配置页，在【自定义功能】配置项下，单击【新建功能】，自定义产品功能。
<img alt="" src="../image/LoRaWAN/explorer_guide_1_2_product_define_list_new.png" /></p>
<h4 id="lorawan">配置 LoRaWAN 参数</h4>
<p>在设备开发页面中，按需调整 LoRaWAN 参数配置。本示例中使用默认的 OTAA 配置。
<img alt="" src="../image/LoRaWAN/explorer_guide_1_3_lorawan_profile.png" /></p>
<h4 id="_4">设备数据解析</h4>
<p>在设备开发页面中，按需调整设备数据解析。由于 LoRa 类资源有限设备不适合直接传输 JSON 格式数据，使用“设备数据解析”可以将设备原始数据转化为产品 JSON 数据。</p>
<h5 id="_5">设备数据协议</h5>
<p>在本示例中，设备上行数据共4字节：
- 第1字节：温度。
- 第2字节：相对湿度。
- 第3、4字节：表示上报周期（单位秒）。
- 设备下行数据为2字节：上报周期（单位秒）。</p>
<h5 id="_6">数据解析脚本</h5>
<p>上行数据解析的脚本主函数为 RawToProtocol，其带有 fPort、bytes 两个入参：
- fPort：设备上报的 LoRaWAN 协议数据的 FPort 字段。
- bytes：设备上报的 LoRaWAN 协议数据的 FRMPayload 字段。</p>
<p>脚本主函数的出参为产品数据模版协议格式的对象。</p>
<p>在上行数据解析部分，javascript 示例代码如下：</p>
<pre><code class="language-javascript">function RawToProtocol(fPort, bytes) {
    var data = {
        &quot;method&quot;: &quot;report&quot;,
        &quot;clientToken&quot; : new Date(),
        &quot;params&quot; : {}
    };
    data.params.temperature = bytes[0];
    data.params.humidity = bytes[1];
    data.params.period = bytes[2] | (bytes[3] &lt;&lt; 8);
    return data;
}
</code></pre>
<p>下行数据解析的脚本主函数为 ProtocolToRaw，其入参为产品数据模版协议格式的对象，其出参为至少3个字节的数组：</p>
<ul>
<li>第1字节：下发给设备的 LoRaWAN 协议数据的 FPort 字段。</li>
<li>第2字节：bytes 为下发给设备的 LoRaWAN 协议数据的 MType（0表示 Unconfirmed Data Down，1表示 Confirmed Data Down）。</li>
<li>第3字节：开始为下发给设备的 LoRaWAN 协议数据的 FRMPayload 字段。</li>
</ul>
<p>在下行数据解析部分，javascript 示例代码如下：</p>
<pre><code class="language-javascript">function ProtocolToRaw(obj) {
    var data = new Array();
    data[0] = 5;// fport=5
    data[1] = 0;// unconfirmed mode
    data[2] = obj.params.period &amp; 0x00FF;
    data[3] = (obj.params.period &gt;&gt; 8) &amp; 0x00FF;
    return data;
}
</code></pre>
<p><img alt="" src="../image/LoRaWAN/explorer_guide_1_4_product_script.png" /></p>
<h5 id="_7">脚本模拟测试</h5>
<p>您也可使用数据解析页面下方的模拟调试工具，如需开发更多的功能，请使用以下模拟脚本。</p>
<ul>
<li>上行消息</li>
</ul>
<p>设备原始数据为 0x113DB80B，我们将其转化为数组，即上行模拟数据为：[17,69,30,0]，填入设备上行数据的编辑框中。单击【运行】，即可在模拟调试界面右侧查看结果。</p>
<p><img alt="" src="../image/LoRaWAN/explorer_guide_1_4_product_script_up_test.png" /></p>
<ul>
<li>下行消息</li>
</ul>
<p>模拟测试数据如下，将其填入设备下行数据的编辑框中：</p>
<pre><code class="language-json">{
    &quot;params&quot;: {
        &quot;period&quot;: 15
    }
}
</code></pre>
<p><img alt="" src="../image/LoRaWAN/explorer_guide_1_4_product_script_down_test.png" /></p>
<h4 id="_8">创建测试设备</h4>
<p>在设备调试页面中，单击【新建设备】，设备名为 dev001。</p>
<p>DevEUI 等信息可从 LoRa 节点开发板背面贴纸上获取。</p>
<p><img alt="" src="../image/LoRaWAN/explorer_guide_1_5_dev_creat_otaa_new.png" /></p>
<h3 id="42-lora">4.2 控制台操作 LoRa 网关</h3>
<ol>
<li>登录 <a href="https://console.cloud.tencent.com/iotexplorer">物联网开发平台控制台</a>，选择上文 “控制台操作 LoRa 节点” 中对应的项目。</li>
<li>在左侧工具列表中，选择【服务中心】&gt;【LoRa 网关管理】。</li>
<li>
<p>进入 LoRa 网关管理页面，选择【添加网关】。
<img alt="" src="../image/LoRaWAN/explorer_guide_3_1_gateway_icon.png" /></p>
</li>
<li>
<p>在新建网关页面，填写网关基本信息。</p>
<ul>
<li>网关名称：本示例中填写 GW1。</li>
<li>GwEUI：为网关唯一ID。本例中根据 ST NUCLEO LoRa GW 背部的 MAC 地址，将6字节 MAC 地址的中间补足0xffff。<br />
<img alt="" src="../image/LoRaWAN/explorer_guide_3_2_gateway_mac.png" /></li>
<li>是否公开：选择“是”，表示社区开发者可在社区网络查看该网关，并可通过这个网关进行 LoRa 节点接入；选择“否”，则仅用户自己能查看该网关。
<img alt="" src="../image/LoRaWAN/explorer_guide_3_3_gateway_creat_new.png" /></li>
</ul>
</li>
<li>网关新建成功后，您可在网关列表页查看“GW1”。</li>
</ol>
<p><img alt="" src="../image/LoRaWAN/explorer_guide_3_4_gateway_list.png" /></p>
<h3 id="43-lora">4.3 LoRa网关实物操作</h3>
<h4 id="_9">硬件连接</h4>
<p>整个系统搭建需要由LRWAN_GS_LF1网关（网关模组和 STM32F746 Nucleo核心板）、5V适配器和电脑组成。</p>
<ol>
<li>先使用 5V 适配器通过 USB 线连接到 LRWAN_GS_LF1 网关的网关模组上的 Micro USB 接口，给整个网关供电。</li>
<li>Nucleo 核心板上的 Micro USB 口（非以太网口那边的 Micro USB 口），通过 USB 线连接到 PC 端，可以实现虚拟串口的功能。</li>
<li>网关开发板通过网线连接到上一级路由器的 LAN 口，从而可以实现 DHCP 的方式连接以太网。
<img alt="" src="../image/LoRaWAN/explorer_guide_4_1_gateway_connect.png" /></li>
</ol>
<h4 id="_10">串口准备</h4>
<ol>
<li>硬件连接成功后，打开 PC 上的设备管理器，即可查看网关所对应的串口（请确保已安装 stlink 驱动）。</li>
</ol>
<p><img alt="" src="../image/LoRaWAN/explorer_guide_4_2_gateway_comm.png" /></p>
<ol>
<li>打开串口工具，做好相应配置后，打开串口。</li>
<li>端口号。本例中为 COM5。</li>
<li>波特率。本例中为 115200。</li>
</ol>
<p><img alt="" src="../image/LoRaWAN/explorer_guide_4_3_gateway_comm_set_new.png" /></p>
<h4 id="_11">配置修改</h4>
<p>请按照如下步骤完成相关配置：
1. 按照上图完成硬件连接和系统搭建。<br />
2. 配置服务器地址。本示例中设置的是腾讯云物联网开发平台的 LoRa 服务器地址（接入域名：<code>loragw.things.qcloud.com</code>，接入端口：1700）。 </p>
<pre><code>AT+PKTFWD=loragw.things.qcloud.com,1700,1700  
</code></pre>
<ol>
<li>配置频率计划。调整频点信息到486.3MHz - 487.7 MHz，指令修改如下（需要逐条发送）：</li>
</ol>
<pre><code>AT+CH=0,486.3,A
AT+CH=1,486.5,A
AT+CH=2,486.7,A
AT+CH=3,486.9,A
AT+CH=4,487.1,B
AT+CH=5,487.3,B
AT+CH=6,487.5,B
AT+CH=7,487.7,B
AT+CH=8,OFF
AT+CH=9,OFF
</code></pre>
<p>示例截图如下所示：
<img alt="" src="../image/LoRaWAN/explorer_guide_4_4_gateway_config.png" />
4. 其他指令。<br />
 - 通过“AT+log=on”打开网关日志。<br />
 - 通过“AT+EUI”查询网关的 ID。  </p>
<h4 id="_12">运行</h4>
<p>通过 AT+Reset 即可复位网关，开始服务器连接。</p>
<p>从串口日志查看：</p>
<pre><code>LORAWAN SERVER: loragw.things.qcloud.com 
</code></pre>
<p>表明服务器地址修改成功。</p>
<pre><code>Ethernet started
DHCP IP: 192.168.3.249
Downlink UDP Connected
Uplink UDP Connected
</code></pre>
<p>表明网关 DHCP 入网成功，网络连接正常。</p>
<h3 id="44-lora">4.4 LoRa 节点实物操作</h3>
<h4 id="_13">编译及下载</h4>
<h5 id="step-1-lorawan">Step 1. 下载 LoRaWAN 例程</h5>
<ol>
<li>请下载 TencentOS tiny 官方开源仓 <a href="https://github.com/Tencent/TencentOS-tiny">下载源码</a> 。</li>
<li>进入<code>&lt;TencentOS-tiny\board\NUCLEO_STM32L073RZ\KEIL\lorawan&gt;</code>目录，打开 TencentOS_tiny.uvprojx 工程。</li>
<li>示例工程包含 STM32L073 外设驱动、TencentOS tiny 内核、AT 框架、RHF76 LoRaWAN 模组驱动、LoRaWAN 示例案例。</li>
</ol>
<h5 id="step-2">Step 2. 代码修改</h5>
<ol>
<li>请先修改<code>\examples\LoRaWAN\lora_demo.c.</code>。</li>
</ol>
<pre><code class="language-c">tos_lora_module_join_otaa(&quot;8cf957200000f806&quot;, &quot;8cf957200000f8061b39aaaaad204a72&quot;);
</code></pre>
<p>填入节点相应的 DevEUI 和 AppKEY，可从 LoRa 节点开发板背面贴纸上获取。
2. 修改<code>\devices\rhf76_lora\RHF76.h</code>。</p>
<pre><code class="language-c">#define RHF76_ATCMD_SET_CHANNEL                 &quot;at+ch=num,0-7\r\n&quot;
</code></pre>
<p>由于本示例中计划使用80 - 87信道，因此调整为：</p>
<pre><code class="language-c">#define RHF76_ATCMD_SET_CHANNEL                 &quot;at+ch=num,80-87\r\n&quot;
</code></pre>
<h5 id="step-3">Step 3. 编译</h5>
<p>单击 MDK 工具栏【Rebuild All】，编译整个工程。</p>
<h5 id="step-4">Step 4. 下载</h5>
<p>单击 MDK 工具栏【Download】，下载编译好的固件。</p>
<h4 id="_14">查看运行结果</h4>
<ol>
<li>节点下载好固件后，会自动重启运行，从串口即可查看设备的运行日志。
<img alt="" src="../image/LoRaWAN/explorer_guide_2_node_run_new.png" /></li>
<li>当您看到串口打印如下日志，即说明 LoRa 节点已经通过网关成功入网。</li>
</ol>
<pre><code>---&gt;+JOIN: Network joined
---&gt;+JOIN: NetID 000035 DevAddr 6B:CC:9B:5D
</code></pre>
<h3 id="45">4.5 查看设备状态</h3>
<ol>
<li>保持 LoRa 节点和 LoRa 网关 为运行状态。</li>
<li>进入【控制台】&gt;【产品开发】&gt;【设备调试】，可查看到设备 "dev001" 。</li>
<li>单击【调试】，可进入设备详情页。
<img alt="" src="../image/LoRaWAN/explorer_guide_5_1_dev_status_new.png" /></li>
<li>单击【设备属性】，可查询设备上报到开发平台的最新数据及历史数据。</li>
<li>设备属性的最新值：会显示设备上报的最新数据。</li>
<li>设备属性的更新时间：显示数据的更新时间。
<img alt="" src="../image/LoRaWAN/explorer_guide_5_1_dev_property_new_new.png" /></li>
<li>单击【查看】，可查看某个属性的历史上报数据。</li>
</ol>
<h3 id="46">4.6 查看设备通信日志</h3>
<p>单击【设备日志】，可查询该设备某段时间范围的所有上下行数据。
 - 上行：上行指设备端上报到开发平台的数据。
 - 下行：下行指从开发平台下发到设备的数据。
<img alt="" src="../image/LoRaWAN/explorer_guide_5_1_dev_log_new_new.png" /></p>
<h3 id="47">4.7 在线调试</h3>
<ol>
<li>当 LoRa 节点 成功连接到物联网开发平台后，您可在控制台【设备调试】列表，单击【调试】，进入在线调试。</li>
<li>将“上报周期”设置为15秒，单击【发送】。
<img alt="" src="../image/LoRaWAN/explorer_guide_6_1_debug.png" /></li>
<li>查看 LoRa 节点的串口日志，可查看已成功接收到下发的数据。<blockquote>
<p>?</p>
</blockquote>
</li>
<li>由于本示例中 LoRa 节点是 LoRaWAN Class A 类设备，这类设备不会立即下发数据，需要在有数据上行后，服务器才会向该设备下行数据。</li>
<li>因此在 LoRa 节点上报数据之后，才能查看下发的周期调整命令。</li>
</ol>
<p>LoRa 节点的串口会显示如下日志，表示成功下发了指令到设备端。</p>
<pre><code>rhf76_incoming_data_process 4: 0F00
len: 2
data[0]: 15
data[1]: 0
report_period: 15
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../15.TencentOS_tiny_EVB_MX_Plus_Quick_Start/" class="btn btn-neutral float-left" title="15.TencentOS_tiny_EVB_MX_Plus_Quick_Start"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../17.Mini_Program_Quick_Start/" class="btn btn-neutral float-right" title="17.Mini_Program_Quick_Start">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../15.TencentOS_tiny_EVB_MX_Plus_Quick_Start/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../17.Mini_Program_Quick_Start/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
